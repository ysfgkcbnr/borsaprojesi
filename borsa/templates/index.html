<!-- Masaüstü Tablo -->
<table class="w-full border-collapse border border-gray-300 text-xs md:text-sm hidden md:table">
    <thead>
        <tr class="bg-gray-200">
            <th id="sort-isim" class="border p-2 cursor-pointer">Hisse Adı</th>
            <th class="border p-2">Borsa</th>
            <th id="sort-fiyat" class="border p-2 cursor-pointer">Fiyat</th>
            <th id="sort-degisim" class="border p-2 cursor-pointer">Değişim (%)</th>
            <th id="sort-hacim" class="border p-2 cursor-pointer">Hacim</th>
            <th class="border p-2">İşlem</th>
        </tr>
    </thead>
    <tbody id="borsa-tablo">
        <!-- Mevcut tbody içeriği aynı kalacak -->
    </tbody>
</table>

<!-- Mevcut script tag'inin içeriğini aşağıdaki ile değiştirin -->
<script>
    const menuBtn = document.getElementById('menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    menuBtn.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
    });

    // Sıralama durumlarını tutacak obje
    const sortStates = {
        'isim': 0,    // 0: orijinal, 1: A-Z, 2: Z-A
        'fiyat': 0,   // 0: orijinal, 1: azalan-artan, 2: artan-azalan
        'degisim': 0,
        'hacim': 0
    };

    // Tablo verilerini alacak fonksiyon
    function getTableData() {
        const rows = Array.from(document.querySelectorAll('#borsa-tablo tr'));
        return rows.map(row => ({
            isim: row.cells[0].textContent.trim(),
            borsa: row.cells[1].textContent.trim(),
            fiyat: parseFloat(row.cells[2].textContent.replace(' TL', '')),
            degisim: parseFloat(row.cells[3].textContent.replace('%', '')),
            hacim: parseInt(row.cells[4].textContent.replace(/,/g, '')),
            html: row.outerHTML
        }));
    }

    // Sıralama fonksiyonu
    function sortTable(column) {
        const tbody = document.getElementById('borsa-tablo');
        let data = getTableData();

        sortStates[column] = (sortStates[column] + 1) % 3;

        if (sortStates[column] === 1) {
            if (column === 'isim') {
                data.sort((a, b) => a.isim.localeCompare(b.isim));
            } else if (column === 'fiyat') {
                data.sort((a, b) => a.fiyat - b.fiyat);
            } else if (column === 'degisim') {
                data.sort((a, b) => a.degisim - b.degisim);
            } else if (column === 'hacim') {
                data.sort((a, b) => a.hacim - b.hacim);
            }
        } else if (sortStates[column] === 2) {
            if (column === 'isim') {
                data.sort((a, b) => b.isim.localeCompare(a.isim));
            } else if (column === 'fiyat') {
                data.sort((a, b) => b.fiyat - a.fiyat);
            } else if (column === 'degisim') {
                data.sort((a, b) => b.degisim - a.degisim);
            } else if (column === 'hacim') {
                data.sort((a, b) => b.hacim - a.hacim);
            }
        }

        // Sıralama 0 ise (orijinal durum) tabloyu yeniden yükle
        if (sortStates[column] === 0) {
            guncelleTablo();
            return;
        }

        // Sıralanmış veriyi tabloya uygula
        tbody.innerHTML = data.map(item => item.html).join('');
    }

    // Tıklama olaylarını ekle
    document.getElementById('sort-isim').addEventListener('click', () => sortTable('isim'));
    document.getElementById('sort-fiyat').addEventListener('click', () => sortTable('fiyat'));
    document.getElementById('sort-degisim').addEventListener('click', () => sortTable('degisim'));
    document.getElementById('sort-hacim').addEventListener('click', () => sortTable('hacim'));

    // Mevcut güncelleme fonksiyonu
    function guncelleTablo() {
        fetch(window.location.href)
            .then(response => response.text())
            .then(html => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const yeniTablo = doc.querySelector('#borsa-tablo');
                document.querySelector('#borsa-tablo').innerHTML = yeniTablo.innerHTML;
                // Sıralama durumlarını sıfırla
                Object.keys(sortStates).forEach(key => sortStates[key] = 0);
            })
            .catch(error => console.log("Hata aga:", error));
    }
    setInterval(guncelleTablo, 30000);
</script>
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Borsa Tablosu</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-4">

    <!-- Masaüstü Tablo -->
    <table class="w-full border-collapse border border-gray-300 text-xs md:text-sm hidden md:table">
        <thead>
            <tr class="bg-gray-200">
                <th id="sort-isim" class="border p-2 cursor-pointer">Hisse Adı</th>
                <th class="border p-2">Borsa</th>
                <th id="sort-fiyat" class="border p-2 cursor-pointer">Fiyat</th>
                <th id="sort-degisim" class="border p-2 cursor-pointer">Değişim (%)</th>
                <th id="sort-hacim" class="border p-2 cursor-pointer">Hacim</th>
                <th class="border p-2">İşlem</th>
            </tr>
        </thead>
        <tbody id="borsa-tablo">
            <!-- Dinamik veriler buraya yüklenecek -->
        </tbody>
    </table>

    <script>
        // Mobil Menü Aç/Kapa
        const menuBtn = document.getElementById('menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        if (menuBtn && mobileMenu) {
            menuBtn.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
        }

        // Sıralama durumlarını tutan obje
        const sortStates = {
            'isim': 0, 'fiyat': 0, 'degisim': 0, 'hacim': 0
        };

        // API veya HTML üzerinden tablo verilerini alma fonksiyonu
        function getTableData() {
            const rows = Array.from(document.querySelectorAll('#borsa-tablo tr'));
            return rows.map(row => ({
                isim: row.cells[0].textContent.trim(),
                borsa: row.cells[1].textContent.trim(),
                fiyat: parseFloat(row.cells[2].textContent.replace(' TL', '')),
                degisim: parseFloat(row.cells[3].textContent.replace('%', '')),
                hacim: parseInt(row.cells[4].textContent.replace(/,/g, '')),
                html: row.outerHTML
            }));
        }

        // Tabloyu sıralama fonksiyonu
        function sortTable(column) {
            const tbody = document.getElementById('borsa-tablo');
            let data = getTableData();

            sortStates[column] = (sortStates[column] + 1) % 3;

            if (sortStates[column] === 1) {
                data.sort((a, b) => column === 'isim' ? a.isim.localeCompare(b.isim) : a[column] - b[column]);
            } else if (sortStates[column] === 2) {
                data.sort((a, b) => column === 'isim' ? b.isim.localeCompare(a.isim) : b[column] - a[column]);
            }

            if (sortStates[column] === 0) {
                guncelleTablo(); // Orijinal verileri yükle
                return;
            }

            tbody.innerHTML = data.map(item => item.html).join('');
        }

        // Sıralama butonları için event listener ekleme
        document.getElementById('sort-isim').addEventListener('click', () => sortTable('isim'));
        document.getElementById('sort-fiyat').addEventListener('click', () => sortTable('fiyat'));
        document.getElementById('sort-degisim').addEventListener('click', () => sortTable('degisim'));
        document.getElementById('sort-hacim').addEventListener('click', () => sortTable('hacim'));

        // Tabloyu güncelleme fonksiyonu
        function guncelleTablo() {
            fetch('/api/borsa-verileri') // Verileri çekeceğin gerçek API buraya gelmeli
                .then(response => response.json())
                .then(data => {
                    const tbody = document.getElementById('borsa-tablo');
                    tbody.innerHTML = ""; // Eski verileri temizle

                    data.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="border p-2">${item.isim}</td>
                            <td class="border p-2">${item.borsa}</td>
                            <td class="border p-2">${item.fiyat} TL</td>
                            <td class="border p-2">${item.degisim} %</td>
                            <td class="border p-2">${item.hacim.toLocaleString()}</td>
                            <td class="border p-2">
                                <button class="bg-blue-500 text-white px-2 py-1 rounded">Al</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });

                    // Sıralama durumlarını sıfırla
                    Object.keys(sortStates).forEach(key => sortStates[key] = 0);
                })
                .catch(error => console.error("Veri yükleme hatası:", error));
        }

        // İlk yüklemede tabloyu güncelle
        guncelleTablo();

        // Tabloyu her 30 saniyede bir güncelle
        setInterval(guncelleTablo, 30000);
    </script>

</body>
</html>
